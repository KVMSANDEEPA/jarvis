<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>J.A.R.V.I.S</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="hud">
    <h1 class="title">J.A.R.V.I.S</h1>
    <div id="chat-box"></div>

    <div class="input-area">
      <input type="text" id="user-input" placeholder="Speak or type a command...">
      <button onclick="sendMessage()">Send</button>
      <button onclick="startVoice()">ðŸŽ¤</button>
    </div>
  </div>

  <script>
    // Append messages to chat box
    function appendMessage(sender, message) {
      const chatBox = document.getElementById("chat-box");
      const msg = document.createElement("div");
      msg.className = sender.toLowerCase() + "-msg";
      msg.innerHTML = `<span>${sender}:</span> ${message}`;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Send message to backend
    async function sendMessage() {
      const input = document.getElementById("user-input");
      const message = input.value.trim();
      if (!message) return;
      appendMessage("You", message);
      input.value = "";

      const response = await fetch("/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });

      const data = await response.json();
      appendMessage("Jarvis", data.reply);
      speak(data.reply);
    }

    // Browser TTS (Jarvis voice)
    function speak(text) {
      const synth = window.speechSynthesis;
      const voice = synth.getVoices().find(v => v.name.includes("Microsoft David") || v.name.includes("Google UK English Male"));
      const utterance = new SpeechSynthesisUtterance(text);
      if (voice) utterance.voice = voice;
      utterance.rate = 1;
      synth.speak(utterance);
    }

    // Voice input (Web Speech API)
    function startVoice() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = "en-US";
      recognition.start();

      recognition.onresult = async (event) => {
        const transcript = event.results[0][0].transcript;
        appendMessage("You", transcript);

        const response = await fetch("/send", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: transcript })
        });

        const data = await response.json();
        appendMessage("Jarvis", data.reply);
        speak(data.reply);
      };
    }
  </script>
</body>
</html>
